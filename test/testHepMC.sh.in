#! /bin/sh
# @configure_input@

# cleanup any old output files first
rm -f testHepMC.out
rm -f testHepMCParticle.out
rm -f testIOAscii.dat
rm -f testIOHepMCExtended.dat

./testHepMC@EXEEXT@ >& testHepMC.cout

OS=`uname`
case "$OS" in
CYGWIN*)
  cmd1=`sed 's/e+0/e+/g' testHepMC.out   | \
       sed 's/e-0/e-/g' -   | \
	@DIFF_Q@ - @srcdir@/testHepMC.dat`
  cmd3=`sed 's/e+0/e+/g' testIOAscii.dat | sed 's/e-0/e-/g' -  | \
       grep -v Version | @DIFF_Q@ - @srcdir@/testAscii.input`
  #don't compare these on Windows (hopelessly different default output)
  cmd2=
  cmd4=
  ;;
Darwin*)
  # MacOSX fix
  cmd1=`@DIFF_Q@ testHepMC.out @srcdir@/testHepMC.dat`
  cmd2=`sed 's/e-00/e+00/g'  @srcdir@/testHepMCParticle.output | \
	@DIFF_Q@ - testHepMCParticle.out`
  cmd3=`cat testIOAscii.dat | grep -v Version | \
        @DIFF_Q@ - @srcdir@/testAscii.input`
  cmd4=`sed 's/IO_GenEvent/IO_ExtendedAscii/g' testIOHepMCExtended.dat | \
        grep -v Version | @DIFF_Q@ - @srcdir@/testHepMCExtended.input`
  ;;
*)
  cmd1=`@DIFF_Q@ testHepMC.out @srcdir@/testHepMC.dat`
  cmd2=`@DIFF_Q@ testHepMCParticle.out @srcdir@/testHepMCParticle.output`
  cmd3=`cat testIOAscii.dat | grep -v Version | \
        @DIFF_Q@ - @srcdir@/testAscii.input`
  cmd4=`sed 's/IO_GenEvent/IO_ExtendedAscii/g' testIOHepMCExtended.dat | \
        grep -v Version | @DIFF_Q@ - @srcdir@/testHepMCExtended.input`
esac

if [ `@DIFF_Q@ testHepMC.cout @srcdir@/testHepMC.output > /dev/null` ]; then
  echo "testHepMC.cout differs"
  exit 1;
fi

if [ -n "$cmd1" ]
then
  echo $cmd1
  exit 1;
fi

if [ -n "$cmd2" ]
then
  echo $cmd2
  exit 1;
fi

if [ -n "$cmd3" ]
then
  echo $cmd3
  exit 1;
fi

if [ -n "$cmd4" ]
then
  echo $cmd4
  exit 1;
fi

exit 0;
